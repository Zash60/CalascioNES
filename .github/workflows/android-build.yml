name: Restructure Project for Android Layout

on:
  push:
    branches: [ "master", "main" ]
  workflow_dispatch: # Permite iniciar manualmente na aba "Actions" do GitHub

jobs:
  restructure:
    runs-on: ubuntu-latest

    steps:
    - name: 1. Checkout do código fonte
      uses: actions/checkout@v4

    - name: 2. Baixar Dependências
      run: |
        echo "Clonando ImGui..."
        git clone --depth 1 https://github.com/ocornut/imgui.git

        echo "Clonando NativeFileDialog..."
        git clone --depth 1 https://github.com/mlabbe/nativefiledialog.git
        
        echo "Baixando SDL2..."
        # Usamos wget para baixar o zip exato que o README menciona
        wget https://github.com/libsdl-org/SDL/releases/download/release-2.30.2/SDL2-devel-2.30.2-mingw.zip
        unzip SDL2-devel-2.30.2-mingw.zip
        # Renomeia a pasta principal para um nome simples: SDL2
        mv SDL2-2.30.2 SDL2

    - name: 3. Criar a Estrutura de Pastas do Projeto
      run: |
        echo "Criando a estrutura de pastas de destino..."
        mkdir -p RestructuredProject/app/src/main/cpp/
        
    - name: 4. Mover Arquivos para a Nova Estrutura
      run: |
        echo "Movendo o código fonte do emulador..."
        mv src         RestructuredProject/app/src/main/cpp/CalascioNES/
        mv include     RestructuredProject/app/src/main/cpp/CalascioNES/
        mv main.cpp    RestructuredProject/app/src/main/cpp/CalascioNES/
        
        echo "Movendo dependências..."
        mv imgui              RestructuredProject/app/src/main/cpp/ImGui/
        mv nativefiledialog   RestructuredProject/app/src/main/cpp/NativeFileDialog/
        mv SDL2               RestructuredProject/app/src/main/cpp/SDL2/
        
        echo "Movendo arquivos de build do repositório original (Makefile, etc.)..."
        mv makefile README.md RestructuredProject/

    - name: 5. Fazer Upload do Projeto Reestruturado
      uses: actions/upload-artifact@v4
      with:
        name: CalascioNES-Android-Structure
        path: RestructuredProject/
